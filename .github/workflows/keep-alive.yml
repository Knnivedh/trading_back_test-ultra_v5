name: Keep Bot Alive

on:
  schedule:
    # Run every 10 minutes during Indian market hours (9:00 AM - 4:00 PM IST)
    # IST is UTC+5:30, so 9:00 IST = 3:30 UTC, 4:00 PM IST = 10:30 UTC
    - cron: '*/10 3-11 * * 1-5'  # Every 10 min, 3:30-11:30 UTC (9:00-17:00 IST), Mon-Fri
    
    # Also ping a few times outside market hours to keep state
    - cron: '0 */2 * * *'  # Every 2 hours (to maintain state overnight)
  
  workflow_dispatch:  # Allow manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Trading Bot API
        run: |
          echo "Pinging trading bot at $(date)"
          curl -s https://trading-back-test-ultra-v5.onrender.com/ || echo "Bot might be starting..."
          sleep 5
          curl -s https://trading-back-test-ultra-v5.onrender.com/state || echo "State endpoint check"
          echo "Ping complete!"
      
      - name: Ping Dashboard
        run: |
          echo "Pinging dashboard at $(date)"
          curl -s https://v5-dashboard.onrender.com/ || echo "Dashboard might be starting..."
          echo "Dashboard ping complete!"
